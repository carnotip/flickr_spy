<!DOCTYPE html>
<html>
  <head>
    <title>Flickr Spy</title>
    <link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.7.2/themes/flick/jquery-ui.css" type="text/css" media="all" />
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.7.2/jquery-ui.min.js"></script>
    
    <script type="text/javascript" src="/jquery.nano.js"></script>
    <script type="text/javascript" src="/jquery.sqrop.js"></script>
    
    <script type="text/javascript" src="/ws/swfobject.js"></script>
    <script type="text/javascript" src="/ws/FABridge.js"></script>
    <script type="text/javascript" src="/ws/web_socket.js"></script>
    <script type="text/javascript">
      WebSocket.__swfLocation = "/ws/WebSocketMain.swf";
    </script>
       
    <script type="text/javascript">
      function append(data) {
        $($.nano('<a href="{page}"><img class="crop" src="{image}" /></a>', data)).
          appendTo($("body")).find("img").hide().load(function(){$(this).sqrop(250).show()})
      }

      var ws = new WebSocket("ws://" + window.location.hostname + ":8080/ncr");
      ws.onmessage = function(e) {
        append(JSON.parse(e.data))
      };
      /*
      $(function(){
        $("canvas").attr("width", $("body").width()).attr("height", 100);
        var canvas = $("canvas").get(0)
        var context = canvas.getContext("2d");
        var imgd = context.createImageData(100, 100);

        function putPixel (i, x, y, r, g, b, a) {
          var p = (x * i.width + y) * 4;
          i.data[p    ] = r;
          i.data[p + 1] = g;
          i.data[p + 2] = b;
          i.data[p + 3] = a;
        }
        
        function getPixel(i, x, y) {
          var p = (x * i.width + y) * 4;
          var pixel = Array.prototype.slice.call(i.data, p, p + 4);
          console.log(pixel)
        }
        
        putPixel(imgd, 10, 10, 255, 0, 0, 255);
        getPixel(imgd, 10, 10);
        context.putImageData(imgd, 0, 0);
      })
      */
    </script>
    <style>
      img {border: none;}
    </style>
  </head>
  <body>
    <canvas><h1>Flickr Spy</h1></canvas>
  </body>
</html>
